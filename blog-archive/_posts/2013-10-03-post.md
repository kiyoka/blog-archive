*Nendo* 副作用の無いコードの静的解析について(2)
前回の続き。( 前回の記事は、右上の窓から同じタイトルで検索してね )

## Nendoにおける型付けについて
 ##(amazon-s 4274069117)  型システム入門 －プログラミング言語と型の理論－: Benjamin C. Pierce
によれば、静的解析をするということは、定義した評価規則と型付規則に従って評価をすることで全ての項を型付けできる。
*[Nendo*]に応用し、最低限その関数が「副作用」の無い関数かを検査できるようにしたい。

(1)ある関数が副作用の無い関数で構築されている場合は、もちろん副作用が無いといえる。
(2)さらには、関数内の束縛関数は破壊したとしても自由変数を破壊しないのであれば、それは副作用の無い関数といってよい。

(1)は自動的に判定することができそうであるが、(2)は人間が判断すればできるのではないか。
そうすれば、現実的なレベルの仕様になるのではないかと考えた。

## 型注釈について
*[Nendo*]では上記のような基準から、「副作用無し」と「副作用有り」というどちらかの型で型付けする案を考えた。
プリミティブな関数に型を付与し、そこからブートストラップで全てのユーザー定義関数に型を付けていこうと考えている。
プリミティブな関数には副作用がある/なしを注釈する。 (型注釈用には :*コロン* が有力。 *[http://cs.brown.edu/courses/cs173/2008/Manual/typed-scheme/index.html|Typed Scheme: Scheme with Static Types*] を参考にした)
- + の場合
!(: +   Pure)

- car と cdr
!(: car Pure)
!(: cdr Pure)

- set! と reverse!
!(: set! Unpure)
!(: reverse! Unpure)  ;; srfi-1

## 自動型付け
上記の型注釈が付いた関数を使って、関数を構築すると自動的に型が付与される。
少なくとも、Pureな関数だけが使用された関数はPureであり、それ以外は全てUnpureと判定すればよい。

!(define (inc1 x)
!  (+ x 1))
 => pureな関数

!(define (fast-reverse! lst)
!  (reverse! lst))
 => unpureな関数

## 感想
TaPLを読んでいるわりには、上記の理論を証明も何もしておらず直感でしか語っていないが、多分いけると思う。

##(comment-data shiro %e3%80%8c%e5%ae%9a%e6%95%b0%e3%81%a7%e3%81%aa%e3%81%84%e3%82%b0%e3%83%ad%e3%83%bc%e3%83%90%e3%83%ab%e5%a4%89%e6%95%b0%e3%82%92%e5%8f%82%e7%85%a7%e3%81%97%e3%81%a6%e3%81%84%e3%81%aa%e3%81%84%e3%80%8d%e3%81%a8%e3%81%84%e3%81%86%e6%9d%a1%e4%bb%b6%e3%81%af%e5%bf%85%e8%a6%81%e3%81%98%e3%82%83%e3%81%82%e3%82%8a%e3%81%be%e3%81%9b%e3%82%93%e3%81%8b%3f)
##(comment-data kiyoka %e3%81%8a%e3%81%a3%e3%81%a8%e3%80%81%e3%82%b0%e3%83%ad%e3%83%bc%e3%83%90%e3%83%ab%e5%a4%89%e6%95%b0%e3%81%8c%e3%81%82%e3%82%8a%e3%81%be%e3%81%99%e3%81%ad%e3%80%82%e3%81%82%e3%81%a8%e3%82%b0%e3%83%ad%e3%83%bc%e3%83%90%e3%83%ab%e5%a4%89%e6%95%b0%e3%81%ae%e4%b8%80%e9%83%a8%e3%81%a0%e3%81%a8%e6%80%9d%e3%81%84%e3%81%be%e3%81%99%e3%81%8c%e7%92%b0%e5%a2%83%e5%a4%89%e6%95%b0%e3%82%82%e3%81%a7%e3%81%99%e3%81%ad%e3%80%82%0d%0aSTDIN%e3%81%a8%e3%81%8bSTDOUT%e3%81%a8%e3%81%8b%e3%81%af%e5%89%af%e4%bd%9c%e7%94%a8%e3%81%ae%e4%bb%a3%e8%a1%a8%e6%a0%bc%e3%81%a7%e3%81%99%e3%81%ad%e3%80%82%0d%0a)
