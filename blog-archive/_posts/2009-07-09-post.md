*Nendo* Rubyとの連携を考える(1)
私がRubyで書いているLisp方言、 *[Nendo*]の開発状況続き。

## Clojureを参考にする
Clojureの .(dot) operatorを使うやりかたはクラスベースのオブジェクト指向言語との連携を行う上で非常に直感的で良いと思う。
.(dot)はJavaでもRubyでもメソッドやインスタンス変数へのアクセス記号として使われているので、見た目でLisp外のメソッド呼びだしが連想しやすい。
以下はClojureのサイトに掲載されているClojureの例。
 *[http://clojure.org/java_interop?responseToken=0726c3f12255d12d0878c0d5a6c09af12|Clojure - java_interop*]
!(.toUpperCase "fred")
!-> "FRED"
!(.getName String)
!-> "java.lang.String"
!(System/getProperty "java.vm.version")
!-> "1.6.0_07-b06-57"
!Math/PI
!-> 3.141592653589793

## Nendoではどうするのか
Clojureの考えかたがそのまま流用出来るかどうか分からないけど、気持ち的にはこんな感じで書きたい。
 Lispのreadの呼びだし
!(read)
 RubyのKernel#readの呼びだし
!(.read)
 インスタンスのnew
!(. new Date)
 同じく、インスタンスのnew
 これは、リーダマクロで (. new Date) に展開されることを想定。
!(Date.new)

 RubyのKernel#openでファイルを開いてすべての行を読みこみ
!(let1 f open( "file.txt" )
!  (f.readlines.to_list))

 ブロックの最後に自動でクローズしてくれるwith-openも欲しい。
 ファイルを読みこんでソートして表示する例。
!(for-each
!  print
!  (with-open( "file.txt" )
!    (lambda (f)
!     (f.readlines.sort_by.to_list)))

多分、Schemerが見てもRubyistが見ても両方キモチワルイと言うだろうな...
とりあえず、ここまで動けば発表のネタにはなるでしょう。
どうです？ちょっと遊んでみたくなりました？

まずは、ターゲットユーザが自分ひとりなので、自分がスラスラ書ける仕様を試してみるつもりです。

##(comment-data sion %e3%81%aa%e3%81%8b%e3%81%aa%e3%81%8b%e6%b5%ae%e4%b8%96%e9%9b%a2%e3%82%8c%e3%81%97%e3%81%9f%e9%ab%98%e5%b0%9a%e3%81%aa%e9%81%8a%e3%81%b3%e3%81%a7%e3%81%99%e3%81%ad%e3%80%82%0d%0a%e5%bd%93%e6%96%b9%e3%80%81%e3%80%8cpython%20%e3%81%8c%20Windows-31J%20%e3%82%92%e7%90%86%e8%a7%a3%e3%81%97%e3%81%a6%e3%81%8f%e3%82%8c%e3%81%aa%e3%81%84%e3%81%8b%e3%82%89%e3%80%81%e3%83%91%e3%83%83%e3%83%81%e3%81%82%e3%81%a6%e3%82%88%e3%81%86%ef%bc%81%e3%80%8d%e3%81%aa%e3%82%93%e3%81%a6%e3%80%81%e6%a5%b5%e3%82%81%e3%81%a6%e9%87%8e%e6%9a%ae%e3%81%aa%e3%81%93%e3%81%a8%e3%82%92%e3%82%84%e3%81%a3%e3%81%a6%e3%81%8a%e3%82%8a%e3%81%be%e3%81%99%28%5e%5e%3b%0d%0a%e3%82%88%e3%81%86%e3%82%84%e3%81%8f%e4%bb%8a%e3%81%ae%e8%81%b7%e5%a0%b4%e3%82%82%20SubVersion%20%e5%b0%8e%e5%85%a5%ef%bc%81%28%e3%81%84%e3%81%be%e3%81%be%e3%81%a7%e3%81%afVSS%29%20%e3%81%93%e3%81%aa%e3%81%84%e3%81%a0%20Wiki%e3%82%82%e7%ab%8b%e3%81%a1%e4%b8%8a%e3%81%92%e3%81%9f%e3%81%97%e3%80%81%e4%bb%8a%e5%ba%a6%e3%81%af%20trac%20%e3%81%a7%e3%82%82%e5%b0%8e%e5%85%a5%e3%81%97%e3%82%88%e3%81%86%e3%81%8b%e3%81%a8%e3%80%82%0d%0a%e3%81%be%e3%81%a3%e3%81%9f%e3%81%8f%e9%96%a2%e4%bf%82%e3%81%aa%e3%81%84%e8%a9%b1%e3%81%a7%e3%81%97%e3%81%9f%e3%81%ad%e3%80%82%0d%0a%e3%83%8d%e3%83%b3%e3%83%89%e9%81%8a%e3%81%b3%e3%81%8c%e3%81%a7%e3%81%8d%e3%81%9d%e3%81%86%e3%81%ab%e3%81%aa%e3%81%a3%e3%81%a6%e3%81%8d%e3%81%9f%e3%82%89%e3%80%81%e6%98%af%e9%9d%9e%e4%bd%bf%e3%82%8f%e3%81%9b%e3%81%a6%e3%81%8f%e3%81%a0%e3%81%95%e3%81%84%e3%81%ad%e3%80%82)
##(comment-data shiro foo.bar%e3%82%92%e3%83%aa%e3%83%bc%e3%83%80%e3%83%9e%e3%82%af%e3%83%ad%e3%81%a7S%e5%bc%8f%e3%81%a8%e3%81%97%e3%81%a6%e8%aa%ad%e3%82%80%e3%81%a8%e3%81%84%e3%81%86%e3%81%ae%e3%81%af%e5%89%8d%e3%81%ab%e3%82%84%e3%81%a3%e3%81%9f%e3%81%93%e3%81%a8%e3%81%8c%e3%81%82%e3%82%8b%e3%82%93%e3%81%a7%e3%81%99%e3%81%8c%20%28%e3%81%9d%e3%81%ae%e6%99%82%e3%81%af%20foo.bar%20%e3%82%92%20%28-%3e%20foo%20bar%29%20%e3%81%a8%e3%81%97%e3%81%a6%e3%81%84%e3%81%9f%29%e3%80%81%0d%0a%e3%83%aa%e3%83%bc%e3%83%80%e3%83%9e%e3%82%af%e3%83%ad%e3%82%92%e7%b4%a0%e7%9b%b4%e3%81%ab%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b%e3%81%a8%e3%81%b2%e3%81%a8%e3%81%a4%e3%81%ae%e3%83%88%e3%83%bc%e3%82%af%e3%83%b3%e3%81%8b%e3%82%89%e3%81%b2%e3%81%a8%e3%81%a4%e3%81%aeS%e5%bc%8f%e3%81%b8%e3%81%ae%e5%a4%89%e6%8f%9b%e3%81%ab%e3%81%aa%e3%82%8b%e3%81%ae%e3%81%a7%e3%80%81%e4%be%8b%e3%81%88%e3%81%b0Date.new%e3%81%a8%e3%81%84%e3%81%86%e3%83%88%e3%83%bc%e3%82%af%e3%83%b3%e3%81%8c%20%28.%20new%20Date%29%20%e3%81%ab%e5%a4%89%e6%8f%9b%e3%81%95%e3%82%8c%e3%82%8b%e3%81%93%e3%81%a8%e3%81%ab%e3%81%aa%e3%82%8b%e3%81%a8%e6%80%9d%e3%81%84%e3%81%be%e3%81%99%e3%80%82%e3%81%a4%e3%81%be%e3%82%8a%20%28Date.new%29%20%e3%81%a8%e3%81%84%e3%81%86%e5%bc%8f%e3%81%af%20%28%28.%20new%20Date%29%29%20%e3%81%ab%e3%81%aa%e3%81%a3%e3%81%a1%e3%82%83%e3%81%86%e3%80%82%0d%0a%e3%83%aa%e3%83%bc%e3%83%80%e3%83%9e%e3%82%af%e3%83%ad%e3%81%absplicing%20%28%e3%83%aa%e3%83%bc%e3%83%80%e3%83%9e%e3%82%af%e3%83%ad%e3%81%8c%e8%bf%94%e3%81%97%e3%81%9f%e3%83%aa%e3%82%b9%e3%83%88%e3%82%92%20%2c%40%20%e3%81%ae%e3%82%88%e3%81%86%e3%81%ab%e8%a6%aa%e3%81%ae%e3%83%aa%e3%82%b9%e3%83%88%e4%b8%ad%e3%81%ab%e5%b1%95%e9%96%8b%e3%81%99%e3%82%8b%29%20%e3%82%92%e8%a8%b1%e3%81%9b%e3%81%b0%20%28Date.new%29%20%e3%82%92%20%28.%20new%20Date%29%20%e3%81%ab%e3%81%99%e3%82%8b%e3%81%93%e3%81%a8%e3%81%af%e5%8f%af%e8%83%bd%e3%81%a7%e3%81%99%e3%81%8c%e3%80%81%e3%81%9d%e3%81%86%e3%81%99%e3%82%8b%e3%81%aa%e3%82%89%e6%ac%a1%e3%81%ae%e3%82%88%e3%81%86%e3%81%aa%e5%a0%b4%e5%90%88%e3%81%ae%e5%8b%95%e4%bd%9c%e3%82%92%e3%81%86%e3%81%be%e3%81%8f%e8%80%83%e3%81%88%e3%81%a6%e3%81%8a%e3%81%8f%e5%bf%85%e8%a6%81%e3%81%8c%e3%81%82%e3%82%8a%e3%81%be%e3%81%99%e3%80%82%0d%0a%28foo%20bar.baz%29%20%3b%20splicing%e3%81%99%e3%82%8b%e3%81%a8%20%28foo%20.%20bar%20baz%29%20%e3%81%ab%e3%81%aa%e3%81%a3%e3%81%a1%e3%82%83%e3%81%86%e3%80%82%0d%0a%28foo%20.%20bar.baz%29%20%3b%20%e3%81%93%e3%82%93%e3%81%aa%e3%81%b5%e3%81%86%e3%81%ab%e4%bd%bf%e3%82%8f%e3%82%8c%e3%81%9f%e3%82%89%e3%81%a9%e3%81%86%e3%81%99%e3%82%8b%3f%0d%0a)
##(comment-data kiyoka %3e%20%e3%81%aa%e3%81%8b%e3%81%aa%e3%81%8b%e6%b5%ae%e4%b8%96%e9%9b%a2%e3%82%8c%e3%81%97%e3%81%9f%e9%ab%98%e5%b0%9a%e3%81%aa%e9%81%8a%e3%81%b3%e3%81%a7%e3%81%99%e3%81%ad%e3%80%82%0d%0a%e3%81%9d%e3%81%86%e3%81%a7%e3%81%99%e3%81%ad%e3%80%82%e4%b8%96%e3%81%ae%e4%b8%ad%e3%83%89%e3%83%a9%e3%82%af%e3%82%a8%e3%81%8c%e7%99%ba%e5%a3%b2%e3%81%95%e3%82%8c%e3%81%9f%e3%81%a8%e3%81%84%e3%81%86%e3%81%ae%e3%81%ab%e3%80%81%e3%81%93%e3%82%93%e3%81%aa%e9%81%8a%e3%81%b3%e3%82%92%e8%a6%8b%e3%81%a4%e3%81%91%e3%81%a6%e3%81%97%e3%81%be%e3%81%84%e3%81%be%e3%81%97%e3%81%9f%e3%80%82%0d%0a%e3%81%aa%e3%81%8b%e3%81%aa%e3%81%8b%e3%81%a9%e3%81%86%e3%81%97%e3%81%a6%e3%82%b2%e3%83%bc%e3%83%a0%e3%81%ab%e5%8c%b9%e6%95%b5%e3%81%99%e3%82%8b%e9%9d%a2%e7%99%bd%e3%81%95%e3%81%a7%e3%81%99%e3%80%82%0d%0a%3e%20%e3%83%8d%e3%83%b3%e3%83%89%e9%81%8a%e3%81%b3%e3%81%8c%e3%81%a7%e3%81%8d%e3%81%9d%e3%81%86%e3%81%ab%e3%81%aa%e3%81%a3%e3%81%a6%e3%81%8d%e3%81%9f%e3%82%89%e3%80%81%e6%98%af%e9%9d%9e%e4%bd%bf%e3%82%8f%e3%81%9b%e3%81%a6%e3%81%8f%e3%81%a0%e3%81%95%e3%81%84%e3%81%ad%e3%80%82%0d%0a%e3%81%82%e3%81%a8%e4%bd%95%e3%83%b6%e6%9c%88%e3%81%8b%e3%81%97%e3%81%9f%e3%82%89%e3%80%81Ruby%e3%81%a8%e7%b5%84%e3%81%bf%e5%90%88%e3%82%8f%e3%81%9b%e3%81%a6%e9%81%8a%e3%81%b9%e3%82%8b%e3%82%88%e3%81%86%e3%81%ab%e3%81%aa%e3%82%8b%e3%81%a8%e6%80%9d%e3%81%84%e3%81%be%e3%81%99%e3%80%82%0d%0a%e3%82%88%e3%82%8d%e3%81%97%e3%81%8f%e3%81%8a%e9%a1%98%e3%81%84%e3%81%97%e3%81%be%e3%81%99%e3%80%82)
##(comment-data kiyoka shiro%e3%81%95%e3%82%93%e3%81%ab%e3%82%b3%e3%83%a1%e3%83%b3%e3%83%88%e3%82%92%e3%82%82%e3%82%89%e3%81%a3%e3%81%a6%e3%81%8b%e3%82%89%e3%81%84%e3%82%8d%e3%81%84%e3%82%8d%e8%80%83%e3%81%88%e3%81%a6%e3%81%bf%e3%81%9f%e3%82%93%e3%81%a7%e3%81%99%e3%81%8c%e3%80%81%e3%83%aa%e3%83%bc%e3%83%80%e3%83%9e%e3%82%af%e3%83%ad%e3%81%a7%e5%8d%98%e9%a0%86%e3%81%ab%e5%a4%89%e6%8f%9b%e3%81%99%e3%82%8b%e3%82%8f%e3%81%91%e3%81%ab%e3%81%af%e3%81%84%e3%81%8b%e3%81%aa%e3%81%9d%e3%81%86%e3%81%a7%e3%81%99%e3%81%ad%e3%80%82%0d%0a%e4%be%8b%e3%81%88%e3%81%b0%e3%80%81%0d%0a%20%28Date.new%29%20%e3%81%af%20%28.%20Date%20new%29%20%e3%81%ab%e5%b1%95%e9%96%8b%e3%81%95%e3%82%8c%e3%81%a6%e6%ac%b2%e3%81%97%e3%81%84%e3%81%91%e3%82%8c%e3%81%a9%e3%82%82%e3%80%81%0d%0a%20%28Date.new.strftime%20%22%25X%22%29%20%e3%81%af%20%28.%20%28.%20Date%20new%29%20strftime%20%22%25X%22%29%20%e3%81%ab%e5%b1%95%e9%96%8b%e3%81%95%e3%82%8c%e3%81%a6%e6%ac%b2%e3%81%97%e3%81%84%e3%81%a8%e6%80%9d%e3%81%a3%e3%81%9f%e3%82%89%e5%8d%98%e7%b4%94%e3%81%ab%e3%81%af%e3%81%84%e3%81%8b%e3%81%aa%e3%81%95%e3%81%9d%e3%81%86%e3%81%a7%e3%81%99%e3%80%82%0d%0a%e3%81%be%e3%81%9f%e3%80%81Clojure%e3%81%a7%e3%82%82%20%28set%21%20%28instance.member_val%29%2020%29%20%e3%81%ae%e3%82%88%e3%81%86%e3%81%ab%20set%21%e3%81%a7%20%e3%82%a4%e3%83%b3%e3%82%b9%e3%82%bf%e3%83%b3%e3%82%b9%e5%a4%89%e6%95%b0%e3%82%92%e6%9b%b4%e6%96%b0%e3%81%a7%e3%81%8d%e3%82%8b%e6%a7%98%e3%81%a7%e3%81%99%e3%81%8c%e3%80%81%e3%81%9d%e3%82%8c%e3%82%82%e5%90%ab%e3%82%81%e3%81%a6%e8%80%83%e3%81%88%e3%82%8b%e3%81%a8%e3%80%81%e7%b5%b1%e4%b8%80%e7%9a%84%e3%81%aa%e3%83%ab%e3%83%bc%e3%83%ab%e3%81%a7%e5%87%a6%e7%90%86%e5%87%ba%e6%9d%a5%e3%82%8b%e3%81%8b%e3%81%a9%e3%81%86%e3%81%8b%e8%80%83%e3%81%88%e3%81%a6%e3%81%84%e3%82%8b%e6%89%80%e3%81%a7%e3%81%99%e3%80%82%0d%0a%e3%82%82%e3%81%86%e3%81%99%e3%81%93%e3%81%97%e8%80%83%e3%81%88%e3%81%8c%e9%80%b2%e3%82%93%e3%81%a0%e3%82%89%e3%83%96%e3%83%ad%e3%82%b0%e3%82%a8%e3%83%b3%e3%83%88%e3%83%aa%e3%82%92%e6%9b%b8%e3%81%8d%e3%81%be%e3%81%99%e3%80%82%0d%0a%e2%80%bb%20%e3%81%9d%e3%82%8c%e3%81%8b%e3%82%89%e3%80%81%e3%81%93%e3%81%ae%e3%82%a8%e3%83%b3%e3%83%88%e3%83%aa%e3%81%a7%20%e3%80%8e%e3%83%aa%e3%83%bc%e3%83%80%e3%83%9e%e3%82%af%e3%83%ad%e3%81%a7%c2%a0%28.%c2%a0new%c2%a0Date%29%c2%a0%e3%81%ab%e5%b1%95%e9%96%8b%e3%81%95%e3%82%8c%e3%82%8b%e3%81%93%e3%81%a8%e3%82%92%e6%83%b3%e5%ae%9a%e3%80%82%e3%80%8f%e3%81%a8%e6%9b%b8%e3%81%84%e3%81%a6%e3%81%84%e3%81%9f%e6%89%80%e3%81%af%20%28.%c2%a0Date%20new%29%e3%81%ae%e9%96%93%e9%81%95%e3%81%84%e3%81%a7%e3%81%97%e3%81%9f%e3%80%82%e3%81%99%e3%81%bf%e3%81%be%e3%81%9b%e3%82%93%e3%80%82%0d%0a)
