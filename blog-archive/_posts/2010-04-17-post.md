*JRuby**Ruby* CRuby-1.9.1とJRuby 1.5.0-RC1の挙動の違いを発見
JRubyのバグかなとTwitterでつぶやいたら、*[http://twitter.com/hiro_asari|@hiro_asari*]さんから、どんな内容か教えて下さいと返信もらったので、これはその説明用エントリです。*[http://twitter.com/hiro_asari|@hiro_asari*]さんありがとうございます。
 *[http://twitter.com/hiro_asari/status/12284922871|Twitter / Hiro Asari: @kiyoka JRubyで1.9相当の挙動を促すに ...*]
 @kiyoka JRubyで1.9相当の挙動を促すには--1.9というフラグが必要です。そ
 れでも違う場合には、どのような物か提示してもらえれば調査してみます。

このあたり、Ruby処理系間の仕様の調整(RubySpecとかあるけど)のノウハウが無いので、後は*[http://twitter.com/hiro_asari|@hiro_asari*]さんにお願いできればと思います。
仕様がちょっと違うというだけのバグなので、JRubyの中身を知っている人ならスグに直せそうな問題です。(JRuby側を合わせるとしたらですが...)
それから、本ブログからソースコードをコピペする場合は、ページタイトル右横の*PLAIN TEXT*アイコンで本ページのTEXT版が出てきます。その方法を試してみて下さい。

## 現象
次のメソッドの返す型が違う。
CRubyはシンボルの配列を返し、JRubyは文字列の配列を返す。
- global_variables
- instance_variables
- local_variables

class_variablesだけは両方の処理系でシンボルの配列を返す。

## 実験結果

## * 実験用ソースコード print_variables.rb
!# -*- encoding: utf-8 -*-
!
!$global_var1 = 1
!$global_var2 = 2
!
!class A
!  @@class_var1 = 1
!  @@class_var2 = 2
!  def initialize
!    @instance_var1 = 1
!    @instance_var2 = 2
!  end
!
!  def view_variables
!    local_var1 = 1
!    local_var2 = 2
!
!    print "global_variables:\n  "
!    p global_variables
!    print "class_variables:\n  "
!    p A.class_variables
!    print "instance_variables:\n  "
!    p self.instance_variables
!    print "local_variables:\n  "
!    p local_variables
!  end
!end
!
!a = A.new
!a.view_variables

## * JRubyの挙動
!$ jruby --1.9 --version
!jruby 1.5.0.RC1 (ruby 1.9.2dev trunk 24787) (2010-04-14 0b08bc7) (Java HotSpot(TM) Client VM 1.5.0_22) *ppc-java*
!$ jruby --1.9 print_variables.rb 
!global_variables:
!  *"$$", "$`", "$@", "$\\", "$<", "$=", "$!", "$.", "$;", "$&", "$\"", "$'", "$,", "$+", "$>", "$:", "$/", "$~", "$0", "$_", "$*", "$?", "$-n", "$-I", "$-p", "$global_var1", "$-a", "$-l", "$global_var2", "$-d", "$-K", "$stderr", "$stdout", "$LOAD_PATH", "$SAFE", "$FILENAME", "$stdin", "$VERBOSE", "$LOADED_FEATURES", "$deferr", "$defout", "$PROGRAM_NAME", "$KCODE", "$DEBUG"*
!class_variables:
!  *:@@class_var1, :@@class_var2*
!instance_variables:
!  *"@instance_var2", "@instance_var1"*
!local_variables:
!  *"local_var1", "local_var2"*

## * CRubyの挙動
!$ ruby --version
!ruby 1.9.1p376 (2009-12-07 revision 26041) *powerpc-darwin9.8.0*
!$ ruby print_variables.rb 
!global_variables:
!  *:$;, :$-F, :$@, :$!, :$SAFE, :$~, :$&, :$`, :$', :$+, :$=, :$KCODE, :$-K, :$,, :$/, :$-0, :$\, :$_, :$stdin, :$stdout, :$stderr, :$>, :$<, :$., :$FILENAME, :$-i, :$*, :$?, :$$, :$:, :$-I, :$LOAD_PATH, :$", :$LOADED_FEATURES, :$VERBOSE, :$-v, :$-w, :$-W, :$DEBUG, :$-d, :$0, :$PROGRAM_NAME, :$global_var1, :$global_var2, :$-p, :$-l, :$-a, :$1, :$2, :$3, :$4, :$5, :$6, :$7, :$8, :$9*
!class_variables:
!  *:@@class_var1, :@@class_var2*
!instance_variables:
!  *:@instance_var1, :@instance_var2*
!local_variables:
!  *:local_var1, :local_var2*

今回初めてTwitterが有効活用されそうな予感です。

##(comment-data %e3%81%82%e3%81%95%e3%82%8a %e5%bf%b5%e3%81%ae%e7%82%ba%e3%81%ab%e8%bf%bd%e8%a8%98%e3%81%97%e3%81%a6%e3%81%8a%e3%81%8d%e3%81%be%e3%81%99%e3%81%a8%e3%80%81http%3a%2f%2ftwitter.com%2fhiro_asari%2fstatus%2f12359856172%20%e3%81%ab%e6%9b%b8%e3%81%8d%e3%81%be%e3%81%97%e3%81%9f%e9%80%9a%e3%82%8a%e3%80%81%e3%81%93%e3%81%ae%e7%82%b9%e3%81%af%20http%3a%2f%2fbit.ly%2facyiqv%20%e3%81%a7%e5%af%be%e5%87%a6%e3%81%97%e3%81%be%e3%81%97%e3%81%9f%e3%80%82%e3%81%94%e5%a0%b1%e5%91%8a%e3%81%ab%e6%84%9f%e8%ac%9d%e3%81%97%e3%81%be%e3%81%99%e3%80%82)
##(comment-data kiyoka %e3%81%82%e3%81%95%e3%82%8a%e3%81%95%e3%82%93%e3%80%81%e3%81%99%e3%81%b0%e3%82%84%e3%81%84%e5%af%be%e5%87%a6%e3%81%82%e3%82%8a%e3%81%8c%e3%81%a8%e3%81%86%e3%81%94%e3%81%96%e3%81%84%e3%81%be%e3%81%99%e3%80%82%e3%81%8a%e5%bd%b9%e3%81%ab%e7%ab%8b%e3%81%a6%e3%81%a6%e3%81%aa%e3%81%ab%e3%82%88%e3%82%8a%e3%81%a7%e3%81%99%e3%80%82%0d%0aCRuby1.9%e4%ba%92%e6%8f%9b%e7%ab%b6%e4%ba%89%e3%81%a7%e3%80%81JRuby%e3%81%8c%e3%83%88%e3%83%83%e3%83%97%e3%82%92%e8%b5%b0%e3%81%a3%e3%81%a6%e3%81%9d%e3%81%86%e3%81%a7%e3%81%99%e3%81%ad%e3%80%82%0d%0a%e3%81%be%e3%81%9f%e4%bd%95%e3%81%8b%e8%a6%8b%e3%81%a4%e3%81%91%e3%81%9f%e3%82%89%e5%a0%b1%e5%91%8a%e3%81%97%e3%81%be%e3%81%99%e3%80%82%0d%0a)
