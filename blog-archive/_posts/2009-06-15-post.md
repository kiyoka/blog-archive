*Nendo* 伝統的なmacroが動いた
ここまで長い道程だったが、macroが動いた。
実際にmacroを実装してみるとmacroがどういうものかやっと理解できた気がする。

## 伝統的なmacroの例

 引数に指定された変数をインクリメントするmacroを定義
!nendo> (define inc (macro (x) (list 'set! x (list '+ '1 x))))
!#<LispMacro:0x00083fcc@(stdin):1>

 変数aを準備
!nendo> (define a 10)
!10

 macroの展開結果を見る
!nendo> (macroexpand1 '(inc a))
!(set! a (+ 1 a))

 実際にインクリメントしてみる
!nendo> (inc a)
!11

 引数に指定した処理を2回実行するmacroを定義
!nendo> (define twice (macro (x) (list 'begin x x)))
!#<LispMacro:0x000720d8@(stdin):6>

 (inc a)をマクロで2回実行
!nendo> (twice (inc a))
!13

 macroの展開結果を見る(1回だけマクロ展開)
!nendo> (macroexpand1 '(twice (inc a)))
!(begin (inc a) (inc a))

 macroの展開結果を見る(2回のマクロ展開)
!nendo> (macroexpand1 (macroexpand1 '(twice (inc a))))
!(begin (set! a (+ 1 a)) (set! a (+ 1 a)))

さて、orとandをmacroで実装してみよう。と思ったが、可変長引数をサポートしていないので、書けないという問題に気がついた。orz.
やっぱり可変長引数は必須なのか...

## macroの可変長引数サポートについて
その後、macroに可変長引数をサポートしようとして,
!(define name (macro (arg1 arg2) body))
という形式ではゼロ個以上の可変長引数がサポートできないことが分かった... o.rz.
要するに、lambdaが入る部分にmacroというキーワードが入る形で考えていた。
そうすると、なにが問題かというと、ゼロ個以上の可変長引数を書きたい場合は、気持ち的には
!(define name (macro (. rest) body))
だが、S式として成立しない。 (. rest) の部分がS式としてエラーとなる。

TinySchemeはmacro定義をつぎの形式で行なうが、この形式ならうまくいく。
!(macro (name arg1 arg2) body)
または、
!(macro name (lambda (arg1 arg2) body)
となっている。

この形式なら
!(macro (name . rest) body)
とかけるのね。
つまり、defineと同じイメージでmacroキーワードを組み立てないといけないのだな。

##(comment-data shiro %28macro%20rest%20body%29%20%e3%81%98%e3%82%83%e3%81%be%e3%81%9a%e3%81%84%e3%81%a7%e3%81%99%e3%81%8b%3f%20%3e%20%e3%82%bc%e3%83%ad%e5%80%8b%e4%bb%a5%e4%b8%8a%e3%81%ae%e5%8f%af%e5%a4%89%e9%95%b7%e5%bc%95%e6%95%b0)
##(comment-data kiyoka %ef%bc%9e%20%28macro%20rest%20body%29%20%e3%81%98%e3%82%83%e3%81%be%e3%81%9a%e3%81%84%e3%81%a7%e3%81%99%e3%81%8b%3f%0d%0a%e3%81%8a%e3%81%a3%e3%81%a8%e3%80%81%e4%bb%8aR5RS%e3%81%ae%e4%bb%95%e6%a7%98%e3%82%92%e3%81%bf%e3%81%9f%e3%82%89%e3%80%81lambda%e3%81%8c%e3%81%9d%e3%81%ae%e5%bd%a2%e5%bc%8f%e3%82%92%e5%8f%96%e3%82%8b%e3%82%93%e3%81%a7%e3%81%99%e3%81%ad%e3%80%82%0d%0a%e5%88%9d%e3%82%81%e3%81%a6%e7%9f%a5%e3%82%8a%e3%81%be%e3%81%97%e3%81%9f%e3%80%82%0d%0amacro%e3%82%82%e5%90%8c%e3%81%98%e5%bd%a2%e5%bc%8f%e3%81%a7%e5%95%8f%e9%a1%8c%e3%81%aa%e3%81%84%e3%81%a7%e3%81%99%e3%80%82%0d%0a%e3%81%a8%e3%81%84%e3%81%86%e3%81%8b%e3%80%81lambda%e3%81%ae%e3%81%bb%e3%81%86%e3%82%82%e3%81%9d%e3%81%ae%e5%bd%a2%e5%bc%8f%e3%82%92%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88%e3%81%97%e3%81%aa%e3%81%84%e3%81%a8%e3%81%84%e3%81%91%e3%81%aa%e3%81%84%e3%81%a7%e3%81%99%e3%81%ad%e3%80%82%0d%0a%0d%0a%e3%81%82%e3%82%8a%e3%81%8c%e3%81%a8%e3%81%86%e3%81%94%e3%81%96%e3%81%84%e3%81%be%e3%81%99%e3%80%82%0d%0a)
