*Nendo* シェルトランポリンの実現方法
私がRubyで書いているLisp方言、 *[Nendo*]について。

## シェルトランポリン
##(img http://www.publicdomainpictures.net/pictures/1000/thumb/238-1211521058obji.jpg)
NendoはRubyで実装しているので、スクリプトをこんな風に始めることはできない。
!#/usr/local/bin/nendo
!.
!.
Rubyのライブラリを静的リンクをすれば出来るけれどそれは大袈裟過ぎるので避けたい。

Gaucheのリファレンスにはこんな方法が紹介されている。
 *[http://practical-scheme.net/gauche/man/gauche-refj_15.html|Gauche ユーザリファレンス: 3.3 Schemeスクリプトを書く*]
!典型的なGaucheスクリプトの最初の行は次のようなものです。
!  (略)
!  #!/bin/sh
!  :; exec gosh -- $0 "$@"
よし、パクろう。(笑)
と思ったが、':' に何か特別な仕組みを持たせないといけないのかも。ちょっと調べてみた。

## Gaucheの ':' は？
さっそく実験。まずはgosh
!bash-3.2$ gosh
!gosh> :
!:
!gosh> (if : 1 2)
!1
!gosh> (symbol? 'a)
!#t
!gosh> (symbol? ':)
!#f
!gosh> (set! : 1)
!*** ERROR: Compile Error: syntax-error: malformed set!: (set! : 1)
!"(stdin)":5:(set! : 1)
うわー、これは何なんだ。よくわからんけど、単体で評価しても無害なようだ。
また、':' は破壊できないようだ。
SchemeのR5RSの仕様を調べたら、':' は拡張アルファベット文字といってアルファベットと同格として扱って良いみたいだけど...
Gaucheはちょっと ':' を特別扱いしているのかな。
なので当然こうなる。
!gosh> :; exec gosh -- $0 "$@"
!:

## bashの ':' は？
bash の':'は常に真を返すコマンドとして有名だ。
!bash-3.2$ :
!bash-3.2$ echo $?
!0
!
!bash-3.2$ while :
!> do
!>   date
!>   sleep 1
!> done
!2009年 9月14日 月曜日 21時57分49秒 JST
!2009年 9月14日 月曜日 21時57分50秒 JST
!2009年 9月14日 月曜日 21時57分51秒 JST
!2009年 9月14日 月曜日 21時57分52秒 JST
!  C-c C-c  (中断)

## 結論
Gaucheのように単に無害な ':' を実装すればよいのかもしれない。
今度実際にやってみよう。

##(comment-data %e9%bd%8a%e8%97%a4 Gauche%20%e3%81%a7%e3%81%af%20%ef%bc%9a%20%e3%82%92%e5%85%88%e9%a0%ad%e3%81%ab%e3%81%a4%e3%81%91%e3%81%9f%e8%ad%98%e5%88%a5%e5%ad%90%e3%81%af%e3%82%ad%e3%83%bc%e3%83%af%e3%83%bc%e3%83%89%e3%81%a8%e3%81%97%e3%81%a6%e6%89%b1%e3%82%8f%e3%82%8c%e3%81%be%e3%81%99%e3%80%82%0d%0a%e5%8d%98%e4%bd%93%e3%81%ae%20%3a%20%e3%81%a7%e3%82%82%e3%82%ad%e3%83%bc%e3%83%af%e3%83%bc%e3%83%89%e3%81%a8%e3%81%97%e3%81%a6%e8%aa%8d%e8%ad%98%e3%81%95%e3%82%8c%e3%82%8b%e3%82%88%e3%81%86%e3%81%a7%e3%81%99%e3%81%ad%e3%80%82%0d%0a%28keyword%3f%20%3a%29%20%e3%81%af%20%23t%20%e3%81%ab%e3%81%aa%e3%82%8a%e3%81%be%e3%81%99%e3%80%82%0d%0ar5rs%20%e3%81%ab%e3%81%af%e7%84%a1%e3%81%84%20Gauche%20%e7%89%b9%e6%9c%89%e3%81%ae%e6%a9%9f%e8%83%bd%e3%81%a7%e3%81%99%e3%81%ae%e3%81%a7%e3%80%81Gauche%20%e3%81%ae%e3%83%9e%e3%83%8b%e3%83%a5%e3%82%a2%e3%83%ab%e3%82%92%e8%a6%8b%e3%81%a6%e4%b8%8b%e3%81%95%e3%81%84%e3%80%82)
##(comment-data kiyoka %e3%82%b3%e3%83%a1%e3%83%b3%e3%83%88%e3%81%82%e3%82%8a%e3%81%8c%e3%81%a8%e3%81%86%e3%81%94%e3%81%96%e3%81%84%e3%81%be%e3%81%99%e3%80%82%0d%0a%e5%85%88%e6%97%a5%e3%80%81Chaton%e4%b8%8a%e3%81%a7leque%e3%81%95%e3%82%93%e3%81%ab%e3%82%82%e6%95%99%e3%81%88%e3%81%a6%e3%82%82%e3%82%89%e3%81%84%e3%81%be%e3%81%97%e3%81%9f%e3%80%82%0d%0aGauche%e3%81%af%e7%b4%94%e7%b2%8b%e3%81%aaScheme%e3%81%8b%e3%82%89%e3%81%86%e3%81%be%e3%81%8f%e6%8b%a1%e5%bc%b5%e3%81%95%e3%82%8c%e3%81%a6%e3%81%84%e3%81%a6%e5%ae%9f%e7%94%a8%e3%83%ac%e3%83%99%e3%83%ab%e3%82%92%e4%bf%9d%e3%81%a3%e3%81%a6%e3%81%84%e3%82%8b%e3%82%93%e3%81%a0%e3%81%a8%e6%80%9d%e3%81%84%e3%81%be%e3%81%97%e3%81%9f%e3%80%82%0d%0a%e3%81%9f%e3%81%a0%e3%80%81Nendo%e3%81%ab%e3%81%af%e3%81%be%e3%81%a0%e3%82%ad%e3%83%bc%e3%83%af%e3%83%bc%e3%83%89%e3%81%af%e5%85%a5%e3%82%8c%e3%81%9a%e3%81%ab%e3%81%84%e3%81%93%e3%81%86%e3%81%8b%e3%81%aa%e3%81%a8%e6%80%9d%e3%81%a3%e3%81%a6%e3%81%84%e3%81%be%e3%81%99%e3%80%82)
